<!DOCTYPE html>
<html lang="en">
<head>
<title>vault engine test</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/nowjs/now.js"></script>

<script>

var signed_in = false;

function handle_errors(result) {
	if (Object.prototype.toString.call(result.error) === '[object Array]') {
		for (var e in result.error) alert(result.error[e]);
	}
	else if (result.error) alert(result.error);
	
	if (Object.prototype.toString.call(result.notice) === '[object Array]') {
		for (var n in result.notice) alert(result.notice[n]);
	}
	else if (result.notice) alert(result.notice);
}

$(document).ready(function() {

	now.receiveMessage = function(name, message) {
		$("#messages").append("<br>" + name + ": " + message);
	}
	
	now.debug = function(message) {
		alert(message);
	}

	$("#send-button").click(function() {
		now.distributeMessage($("#text-input").val());
		$("#text-input").val("");
	});

	$("#signin-button").click(function() {
		now.signIn($('#username').val(), $('#password').val(), function(result) {
			handle_errors(result);
			if (result.success) {
				$('#user-area').html('signed in as ' + result.data.name);
				$('#signin-button').hide();
				$('#signup-button').hide();
				$('#signout-button').show();
				$('#username').hide();
				$('#password').hide();
			}
		});
	});
	
	$('#signout-button').click(function() {
		now.signOut(function(result) {
			handle_errors(result);
			if (result.success) {
				$('#user-area').html('not signed in');
				$('#signin-button').hide();
				$('#signup-button').hide();
				$('#signout-button').hide();
				$('#username').show();
				$('#password').show();
				$('#username').val('');
				$('#password').val('');
			}
		});
	});
	
	$("#signup-button").click(function() {
		now.signUp($('#username').val(), $('#password').val(), $('#confirm-password').val(), function(result) {
			handle_errors(result);
			if (result.success) {
				$('#signup-button').hide();
				$('#confirm-password').hide();
				$('#confirm-password').val('');
				$('#signin-button').show();
			}
		});
	});
	
	$('#username').blur(function() {
		now.playerExists($('#username').val(), function(exists) {
			if (exists) {
				$('#confirm-password').hide();
				$('#signup-button').hide();
				$('#signin-button').show();
			}
			else {
				$('#confirm-password').show();
				$('#signup-button').show();
				$('#signin-button').hide();
			}
		});
	});

});
</script>
</head>

<body>
	<div>
		<span id="user-area">not signed in</span>
		<input type="button" value="Sign Out" id="signout-button" style="display: none;">
	</div>
	<input type="text" id="username" placeholder="username">
	<input type="password" id="password" placeholder="password">
	<input type="password" id="confirm-password" placeholder="confirm password" style="display: none;">
	<input type="button" value="Sign In" id="signin-button" style="display: none;">
	<input type="button" value="Sign Up" id="signup-button" style="display: none;">
	<div id="messages"></div>
	<input type="text" id="text-input">
	<input type="button" value="Send" id="send-button">
</body>
</html>